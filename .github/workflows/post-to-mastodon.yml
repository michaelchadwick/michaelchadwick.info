name: New blog Mastodon post
on:
  push:
    paths:
      - 'blog/_posts/*.md'

jobs:
  Post-To-Mastodon:
    if: contains(github.event.head_commit.message, 'new blog post:')
    env:
      commitmsg: ${{ github.event.head_commit.message }}
    runs-on: ubuntu-latest
    steps:
    - name: Notes üìù
      id: notes
      run: |
        echo "::set-output name=postname::$(git diff-tree --no-commit-id --name-only -r ${{ github.sha }})"
    - name: mastodon-send
      id: mastodon
      uses: cbrgm/mastodon-github-action@v1.0.3

      with:
        message: |
          New post on my blog: $commitmsg
          ${{ steps.notes.outputs.postname }}
          https://michaelchadwick.info/blog
          #blog
        visibility: "private" # default: public
      env:
        MASTODON_URL: ${{ secrets.MASTODON_URL }}
        MASTODON_ACCESS_TOKEN: ${{ secrets.MASTODON_ACCESS_TOKEN }}
